<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="/CSS/persistent_tab.css">
<div id="nav">
    <div id="nav-wrapper">
        <ul>
            <li><a class="navbtn" href="/home" border="none">Home</a></li>
            <li><a class="navbtn"  href="/earn">Earn</a></li>
            <li><a class="navbtn"  href="/redeem">Redeem</a></li>
            <li>
                    <button class="btnarea dropdown navbtn" disabled>
                        
                        EXP
                        <p class=" dropdown " id="pointText" onclick="redeemFunction()" disabled>
                            {{score}}
                        </p>
                        /
                        <p class=" dropdown " id="nextLevelExpText" onclick="redeemFunction()" disabled>
                        {{nextLevelExp}}
                        </p>
                        <div class="progress bar-con">
                        <div class="bar" id="navProgressBar" data-percent="0"></div>
                        </div>
                    </button>

                    <div id="redeemDropDown" class="dropdown-content">
                        <a href="/redeem" align="center">Redeem</a>
                    </div>
            </li>
            <li>
                <button class="btnarea dropdown dropbtn" onclick="myFunction()">                   
                    Welcome, {{name}}
                </button>
          
                <div id="myDropdown" class="dropdown-content">
                    <a href="/" align="center">Sign Out</a>
                </div>
            </li>
            
        </ul>
    </div>
</div>
<br>
<br>
<br>
<br>
<script>
    var localPercent = 0;
    (function($) {
        $.fn.progress = function() {
            var percent = this.data("percent");
            this.css("width", localPercent + "%");
            console.log("UPDATEEEE!!" + percent);
        };
    }(jQuery));

    $(document).ready(function() {
        
        
    });
    /* When the user clicks on the button, 
     */
    function myFunction() {
        document.getElementById("myDropdown").classList.toggle("show");
    }
    function redeemFunction() {
        document.getElementById("redeemDropdown").classList.toggle("show");
    }
    
    function calcNavPercent(total, req) {
        if(total > req) {
            return 100;
        }
        else { 
            return (total/req*100);
        }
    }
    
    function loadNavProgress() {
        //console.log("nextLevelExp " + nextLevelExp);
        var totalPoints = parseInt($("#pointText").text());
        var itemPoints = parseInt($("#nextLevelExpText").text());
        console.log(itemPoints);
        console.log(totalPoints);
        var percent = calcNavPercent(totalPoints, itemPoints);
        localPercent = percent
        console.log("setting" + percent);
        document.getElementById("navProgressBar").setAttribute("data-percent", percent);
        $(".progress .bar").progress();
    }
    loadNavProgress();
    setInterval(loadNavProgress, 1000);
    
    
    // Close the dropdown menu if the user clicks outside of it
    /*
    window.onclick = function(event) {
        
        if (!event.target.matches('.btnarea')) {

            var dropdowns = document.getElementsByClassName("dropdown-content");
            var i;
            for (i = 0; i < dropdowns.length; i++) {
                var openDropdown = dropdowns[i];
                if (openDropdown.classList.contains('show')) {
                    openDropdown.classList.remove('show');
                }
            }
        }
        
    }
    */

</script>
